parameters:
  terraformWorkingDirectory: 'terraform/sample'

steps:
  - checkout: self

  - task: TerraformInstaller@1
    displayName: 'Install Terraform'
    inputs:
      terraformVersion: '1.6.6'

  - task: PowerShell@2
    displayName: 'Terraform fmt (check)'
    inputs:
      targetType: 'inline'
      script: |
        cd ${{ parameters.terraformWorkingDirectory }}
        terraform fmt -check -recursive

  - task: PowerShell@2
    displayName: 'Terraform init'
    inputs:
      targetType: 'inline'
      script: |
        cd ${{ parameters.terraformWorkingDirectory }}
        terraform init -backend=false

  - task: PowerShell@2
    displayName: 'Terraform validate'
    inputs:
      targetType: 'inline'
      script: |
        cd ${{ parameters.terraformWorkingDirectory }}
        terraform validate
